**End to End Node.js Web Application Deployment on K8s (AWS EKS /Local K8s Cluster) with Jenkins**



**ЁЯзк Project-1: Node.js Web Application Deployment on Docker with Jenkins**

**Node.js Web Application Deployment on Docker with Jenkins** рдХрд╛ project structure рджрд┐рдпрд╛ рд╣реИ, рдореИрдВ рдЖрдкрдХреЛ same-to-same lab setup рдмрдирд╛рдХрд░ рджреВрдБрдЧрд╛ step-by-step, рддрд╛рдХрд┐ рдЖрдк рд╕реАрдзреЗ рдЕрдкрдиреЗ test server рдкрд░ try рдХрд░ рд╕рдХреЛред

рдпреЗ project 3 parts рдореЗрдВ рд╣реЛрдЧрд╛:

- **Node.js App Setup on Server**
- **Dockerize the Node.js App**
- **Jenkins Pipeline for CI/CD**



**1я╕ПтГг Project Directory Structure**

<https://github.com/htyagi2233/nodejs-docker-project.git> 



nodejs-docker-project

тФЬтФАтФА package.json

тФЬтФАтФА package-lock.json

тФЬтФАтФА public

тФВ┬а┬а тФЬтФАтФА images

тФВ┬а┬а тФВ┬а┬а тФФтФАтФА nodejs-logo.png

тФВ┬а┬а тФЬтФАтФА index.html

тФВ┬а┬а тФФтФАтФА styles.css

тФЬтФАтФА README.md

тФЬтФАтФА src

тФВ┬а┬а тФЬтФАтФА app.js

тФВ┬а┬а тФФтФАтФА imageDisplay.js

тФФтФАтФА tests

`    `тФЬтФАтФА imageDisplay.test.js

`    `тФЬтФАтФА package.json

`    `тФФтФАтФА package-lock.json





................................................... Installaion process on test server ................................................................................................................



- Go to NodeJs Officially Site ->  <https://nodejs.org/en/download>
- And install Node.js on test Server

┬а



![Machine generated alternative text:
Download Node.js@ 
using V nvm 
with 
npm 
bash 
Copy to clipboard 
Get Node.js@ v22.19.o (LTS) 
for Linux 
Info Want new features sooner? Get the latest version instead and to' the latest improvements! 
1 
2 
3 
4 
5 
6 
7 
8 
9 
18 
11 
12 
13 
14 
15 
Bash 
# Download and install nvm: 
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v@.4@.3/insta11.sh 
# in lieu of restarting the shell 
X. "$HOME/ .nvm/nvm.sh" 
# Download and install Node .js: 
nvm install 22 
# Verify the Node. js version: 
node -v # Should print "v22.19.@" . 
nvm current # Should print "v22.19.@" 
# Verify npm version: 
npm -v # Should print "1@.9.3" 
"nvm" is a cross-platform Node.js version manager. If you encounter any issues please visit nvmтАвs website 7 
Or get a prebuilt Node.js@for 
Windows Installer (.msi) 
тАв Windows 
running a x64 
architecture. 
Standalone Binary (lip) ](Aspose.Words.90e71230-3abd-49e0-a7dc-481fdea0b198.001.png)















- **Copy first command and run on test Server-**

  curl -o- <https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh> | bash

┬а

┬а

┬а

- **Command install рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд░ output рдореЗрдВ рд╣рдореЗрдВ 3 command рдорд┐рд▓реЗрдВрдЧреА рдЕрдм рд╣рдореЗрдВ рдЗрд╕ 3 command рдХреЛ run рдХрд░рдирд╛ рд╣реИ test server рдкрд░** 



export NVM\_DIR="$HOME/.nvm"

[ -s "$NVM\_DIR/nvm.sh" ] && \. "$NVM\_DIR/nvm.sh"  # This loads nvm

[ -s "$NVM\_DIR/bash\_completion" ] && \. "$NVM\_DIR/bash\_completion"  # This loads nvm bash\_completion







\# in lieu of restarting the shell

\. "$HOME/.nvm/nvm.sh"



\# Download and install Node.js:

nvm install 22



\# Verify the Node.js version:

node -v # Should print "v22.19.0".

nvm current # Should print "v22.19.0".



\# Verify npm version:

npm -v # Should print "10.9.3".







- ` `**This file is available in GitHub Repository** 

  <https://github.com/htyagi2233/nodejs-docker-project.git> 

┬а

  # cat package.json

┬а

  {

  `  `"name": "my-nodejs-spa",

  `  `"version": "1.0.0",

  `  `"description": "A Node.js SPA project with Jest tests",

  `  `"main": "src/app.js",

  `  `"scripts": {

  `    `"start": "node src/app.js",

  `    `"test": "jest"

  `  `},

  `  `"dependencies": {

  `    `"express": "^4.19.2"

  `  `},

  `  `"devDependencies": {

  `    `"jest": "^27.5.1"

  `  `},

  `  `"directories": {

  `    `"test": "tests"

  `  `},

  `  `"keywords": [],

  `  `"author": "",

  `  `"license": "ISC"

  }

┬а

┬а

┬а

┬а

- **So based on this file we will installed dependency** 

  # npm install express

  # npm install --save-dev jest

  # npm start

┬а

┬а

- **Copy the Jenkins Server ip and browse with 3000 port** 

Server is running on <http://0.0.0.0:3000>









**Project- 2  Git Checkout stage**  

**This project we will do on a jenkins inside a docker container** тАжтАжтАжтАжтАжтАжтАжтАжтАжтАжтАжтАжтАжтАжтАж.тАж.



**Step-1**



**ЁЯОп Project Objective:**

- Jenkins рдХреЛ Docker container рдореЗрдВ рдЪрд▓рд╛рдирд╛
- GitHub рд╕реЗ Node.js Project рдХреЛ Jenkins pipeline рдХреЗ рдЬрд╝рд░рд┐рдП checkout рдХрд░рдирд╛
- Jenkins рдореЗрдВ Git integration рдФрд░ pipeline configuration рдХреЛ рд╕рдордЭрдирд╛
- GitHub token рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ secure authentication рдХрд░рдирд╛
- Jenkins рдореЗрдВ Build Discarder рдЬреИрд╕реЗ options рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдирд╛





- **Project Directory Structure on my local server** 

  <https://github.com/htyagi2233/nodejs-docker-project.git>

┬а

  nodejs-docker-project

  тФЬтФАтФА package.json

  тФЬтФАтФА package-lock.json

  тФЬтФАтФА public

  тФВ┬а┬а тФЬтФАтФА images

  тФВ┬а┬а тФВ┬а┬а тФФтФАтФА nodejs-logo.png

  тФВ┬а┬а тФЬтФАтФА index.html

  тФВ┬а┬а тФФтФАтФА styles.css

  тФЬтФАтФА README.md

  тФЬтФАтФА src

  тФВ┬а┬а тФЬтФАтФА app.js

  тФВ┬а┬а тФФтФАтФА imageDisplay.js

  тФФтФАтФА tests

  `    `тФЬтФАтФА imageDisplay.test.js

  `    `тФЬтФАтФА package.json

  `    `тФФтФАтФА package-lock.json

┬а

- **Create GitHub Repo**
  - GitHub рдореЗрдВ login рдХрд░реЛ тЖТ **New Repository** рдкрд░ click рдХрд░реЛред
  - Example: nodejs-docker-project рдирд╛рдо рд╕реЗ repo рдмрдирд╛ рд▓реЛред
  - Repo public/~~private~~ рдХреЛрдИ рднреА рд░рдЦ рд╕рдХрддреЗ рд╣реЛред

<https://github.com/htyagi2233/nodejs-docker-project.git>



- **Create Token in GitHub (Personal Access Token - PAT)**

  рдХреНрдпреЛрдВрдХрд┐ GitHub рдЕрдм password-based authentication allow рдирд╣реАрдВ рдХрд░рддрд╛ push рдХреЗ рд▓рд┐рдПред

- GitHub тЖТ Profile тЖТ **Settings**
- Developer Settings тЖТ **Personal Access Tokens** тЖТ Tokens (classic) тЖТ **Generate new token**
- Scope select рдХрд░реЛ тЖТ рдХрдо рд╕реЗ рдХрдо repo (for repo access)
- Token generate рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж copy рдХрд░рдХреЗ рдХрд╣реАрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦ рд▓реЛред





- **Connect Repo to Jenkins Server (Vmware)**
  - Jenkins server рдореЗрдВ login рдХрд░реЛред
  - git client installed рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (apt install git -y Ubuntu рдкрд░)ред
  - Repo рдХреЛ test рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Jenkins server рдкрд░ run рдХрд░реЛ:\
\
    git clone <https://github.com/USERNAME/nodejs-docker-project.git>
  - рдЬрдм password рдорд╛рдВрдЧреЗрдЧрд╛ тЖТ username = рдЖрдкрдХрд╛ GitHub username рдФрд░ password = **token**ред



- **Push Code into GitHub using Username + Token**

  рдорд╛рди рд▓реЛ рдЖрдкрдиреЗ local рдореЗрдВ project рдмрдирд╛рдпрд╛ рд╣реИ nodejs-docker-project/

┬а

  cd nodejs-docker-project\
  git init\
  git add .\
  git commit -m "Initial commit"\
  git remote add origin <https://github.com/USERNAME/nodejs-docker-project.git>\
  git push <https://USERNAME:TOKEN@github.com/USERNAME/nodejs-docker-project.git> main

  ЁЯТб рдпрд╣рд╛рдБ TOKEN рд╡рд╣реА рд╣реЛрдЧрд╛ рдЬреЛ GitHub рд╕реЗ generate рдХрд┐рдпрд╛ рдерд╛ред

┬а

┬а

┬а

- **Now Create the Jenkins on docker container** 

  docker run -d --name jenkins -p 8080:8080 -v jenkins\_home:/var/jenkins\_home jenkins/jenkins

┬а

┬а

┬а

┬а

- ` `**Check Running Jenkins Container**

  рдкрд╣рд▓реЗ рджреЗрдЦреЛ рдЖрдкрдХрд╛ Jenkins container рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ:

┬а

  docker ps

  Output рдореЗрдВ рдХреБрдЫ рдРрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛:

┬а

  CONTAINER ID   IMAGE             COMMAND        PORTS                    NAMES\
  abcd1234efgh   jenkins/jenkins   ...            0.0.0.0:8080->8080/tcp   my-jenkins

┬а

- **Login into Jenkins Container**

  Container рдореЗрдВ enter рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

┬а

  docker exec -it my-jenkins bash

  ЁЯСЙ рдпрд╣рд╛рдБ my-jenkins рдЖрдкрдХрд╛ container рдХрд╛ name/ID рд╣реЛрдЧрд╛ред

┬а

- **Get Initial Admin Password (First Time Login)**

  рдЕрдЧрд░ Jenkins рдкрд╣рд▓реА рдмрд╛рд░ run рдХрд┐рдпрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ admin password рдЪрд╛рд╣рд┐рдПред

  Container рдХреЗ рдЕрдВрджрд░ рдпреЗ command рдЪрд▓рд╛рдУ:

┬а

  cat /var/jenkins\_home/secrets/initialAdminPassword

  ЁЯСЙ рдпрд╣ long random string рд╣реЛрдЧрд╛ тЖТ рдЗрд╕реЗ copy рдХрд░рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ Jenkins UI рдкрд░ paste рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

┬а

- **Jenkins Web Login**
  - **Browser рдореЗрдВ рдЦреЛрд▓реЛ:\
\
    [**http://localhost:8080**](http://localhost:8080)**
  - **Username: admin (default)**
  - **Password: рдКрдкрд░ рд╡рд╛рд▓рд╛ initialAdminPassword**





- **Install Jenkins Plugins**
- Jenkins Dashboard тЖТ **Manage Jenkins тЖТ Plugins тЖТ Available Plugins**
- Install рдХрд░реЛ:
  - **Pipeline** (рдЕрдЧрд░ рдкрд╣рд▓реЗ рд╕реЗ install рдирд╣реАрдВ рд╣реИ)
  - **Git Plugin**
  - **GitHub Plugin**





- **Jenkins рдореЗрдВ Job Create рдХрд░рдирд╛**
  - Jenkins Dashboard тЖТ **New Item**
  - Job Name: Node-js-project
  - Type: **Pipeline** рдЪреБрдиреЛ тЖТ OK





- Node-js-project -> pipeline 
  - Add option -> build discarder 
  - Git Checkout in Stage 





- **Pipeline Script**

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

        

  `    `}

┬а

  }

┬а

┬а

┬а

- **Build the Job**
  - **Jenkins Dashboard тЖТ Node-js-project рдкрд░ click рдХрд░реЗрдВ**
  - **Left side тЖТ Build Now рдкрд░ click рдХрд░реЗрдВ**



- **Console Output Check рдХрд░реЗрдВ**
  - **Build Number (#1, #2 etc.) рдкрд░ click рдХрд░реЗрдВ**
  - **рдлрд┐рд░ Console Output рдЦреЛрд▓реЗрдВ**

ЁЯСЙ рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рдпреЗ steps рджрд┐рдЦрдиреЗ рдЪрд╛рд╣рд┐рдП:

- **Started by user admin** (рдпрд╛ рдЖрдкрдХрд╛ user)
- Jenkins workspace set рдХрд░реЗрдЧрд╛
- Git plugin тЖТ рдЖрдкрдХреЗ repo <https://github.com/htyagi2233/nodejs-docker-project.git> рд╕реЗ checkout рдХрд░реЗрдЧрд╛
- Branch тЖТ \*/main fetch рд╣реЛрдЧреА

рдЕрдЧрд░ рд╕рдм рд╕рд╣реА рд╣реИ рддреЛ output рдореЗрдВ рдХреБрдЫ рдРрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛:



Cloning the remote Git repository\
Cloning repository <https://github.com/htyagi2233/nodejs-docker-project.git>\
` `> git init ...\
` `> git fetch ...\
` `> git checkout main



- **Build Discarder Verify рдХрд░реЗрдВ**
  - **Dashboard тЖТ Job тЖТ Build History рдореЗрдВ рджреЗрдЦреЛ**
  - **рдЕрдЧрд░ рдЖрдкрдиреЗ рдХрдИ рдмрд╛рд░ build рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдХреЗрд╡рд▓ last 2 builds рд╣реА рджрд┐рдЦреЗрдВрдЧреА (рдмрд╛рдХреА Jenkins рдиреЗ auto delete рдХрд░ рджреА рд╣реЛрдВрдЧреА, рдХреНрдпреЛрдВрдХрд┐ buildDiscarder option рд▓рдЧрд╛рдпрд╛ рд╣реИ)ред**







**Project-3:  Node Build stage** 



- **Add nodejs -v stage in pipeline and build the job, here we got the error** 

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

  `        `stage('node stage'){

  `            `steps{

  `                `sh 'node -v'

  `            `}

  `        `}

        

  `    `}

┬а

  }

┬а

┬а

┬а

┬а

  **тЭМ Error Explanation**

┬а

  /var/jenkins\_home/workspace/node-js-project@tmp/durable-bf128a2d/script.sh.copy: 1: node: not found

┬а

┬а

┬а

┬а

┬а

  **тЬЕ Solution тАУ Install NodeJS in Jenkins**

  рдЗрд╕рдХреЛ solve рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдкрд╛рд╕ 2 рддрд░реАрдХреЗ рд╣реИрдВ:

┬а

  **ЁЯФ╣ NodeJS Plugin in Jenkins** 

- **Jenkins Dashboard тЖТ Manage Jenkins тЖТ Plugins тЖТ Available plugins**
  - **Install NodeJS Plugin**

┬а

- **Configure NodeJS in Jenkins**
  - **Manage Jenkins тЖТ Tools**
  - **Scroll down to NodeJS installations**
  - **Add тЖТ Name: Nodejs**
  - **Check тЬЕ "Install automatically"**
  - **Save**

┬а

- **рдЕрдм pipeline рдореЗрдВ tools section add рдХрд░реЗрдВ:**

ЁЯСЙ рдЕрдм Jenkins рдкрд╣рд▓реЗ NodeJS tool install рдХрд░реЗрдЧрд╛ рдФрд░ рдлрд┐рд░ рд╡реЛ path рдореЗрдВ add рдХрд░рдХреЗ node command run рдХрд░ рдкрд╛рдПрдЧрд╛ред







pipeline{

`    `agent any

`    `options {

`        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

`    `}

`    `tools{

`        `nodejs 'Nodejs'

`    `}

`    `stages{

`        `stage('Git Checkout'){

`            `steps{

`                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

`            `}

`        `}

`        `stage('node stage'){

`            `steps{

`                `sh 'node -v'

`            `}

`        `}



`    `}



}







**Build the Job**

- Jenkins Dashboard тЖТ Node-js-project рдкрд░ click рдХрд░реЗрдВ
- Left side тЖТ **Build Now** рдкрд░ click рдХрд░реЗрдВ





**Build Now тЖТ Console Output**

рдЕрдЧрд░ рд╕рдмрдХреБрдЫ рд╕рд╣реА рд╣реИ рддреЛ рдЖрдкрдХреЛ output рдорд┐рд▓реЗрдЧрд╛:



[Pipeline] sh\
\+ node -v\
v22.19.0

ЁЯСЙ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ Jenkins рдиреЗ NodeJS plugin рд╕реЗ Node рдФрд░ npm рдХреЛ PATH рдореЗрдВ load рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред

\--------------------------------------------------------------------------------------------------------------- 

**тЪая╕П Common Issues**

- рдЕрдЧрд░ рдлрд┐рд░ рднреА node: not found рдЖрддрд╛ рд╣реИ тЖТ\
  ЁЯФ╣ Check рдХрд░реЛ рдХрд┐ pipeline рдореЗрдВ tools { nodejs 'Nodejs' } рд▓рд┐рдЦрд╛ рд╣реИ рдФрд░ рдирд╛рдо рд╕рд╣реА рд╣реИред\
  ЁЯФ╣ Plugin install рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж Jenkins restart рдХрд░рдирд╛ рдордд рднреВрд▓рдирд╛ред







**Project-4:**

**Now check npm install and npm version** 



**This time we will check npm version and npm install** 



pipeline{

`    `agent any

`    `options {

`        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

`    `}

`    `tools{

`        `nodejs 'Nodejs'

`    `}

`    `stages{

`        `stage('Git Checkout'){

`            `steps{

`                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

`            `}

`        `}

`        `stage('node stage'){

`            `steps{

`                `sh 'node -v'

`                `sh 'npm -v'

`                `sh 'npm install'

`            `}

`        `}



`    `}



}







**Build Now тЖТ Console Output**

рдЕрдЧрд░ рд╕рдмрдХреБрдЫ рд╕рд╣реА рд╣реИ рддреЛ рдЖрдкрдХреЛ output рдорд┐рд▓реЗрдЧрд╛:



[Pipeline] sh\
\+ node -v\
v22.19.0

[Pipeline] sh\
\+ npm -v\
10\.9.3

ЁЯСЙ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ Jenkins рдиреЗ NodeJS plugin рд╕реЗ Node рдФрд░ npm рдХреЛ PATH рдореЗрдВ load рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред







**Project-5: Dockerfile for NodeJS**



**ЁЯР│ Node.js App Dockerfile Setup**

**1я╕ПтГг Create Dockerfile**

Project directory (nodejs-docker-project/) рдореЗрдВ Dockerfile рдмрдирд╛рдЗрдпреЗ ЁЯСЗ







\# Use official Node.js base image\
FROM node:latest

\# Create app directory inside container\
WORKDIR /usr/src/app

\# Copy package.json and package-lock.json\
COPY package\*.json ./

\# Install app dependencies\
RUN npm install

\# Copy application source code\
COPY . .

\# Expose app port\
EXPOSE 3000

\# Start the app\
CMD ["npm", "start"]







**Step- Build the Docker Image and verify docker version for testing using jenkins pipeline**

- Above Dockerfile will use to create image and push into DockerHub using Jenkins Pipeline and that image will use to deploy application in k8s 

┬а

  **тЬЕ Build the Docker Image for NodeJS**\
  тЖТ Source code рд╕реЗ Dockerfile рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Node.js рдРрдк рдХреА Docker image рддреИрдпрд╛рд░ рдХрд░рдирд╛ред

┬а

  docker build -t jenkins/jenkins .

┬а

  **тЬЕ Create a DockerHub Repo - htyagi2233/jenkins-nodejs**\
  тЖТ DockerHub рдкрд░ рдПрдХ remote repository рдмрдирд╛рдирд╛ рдЬрд╣рд╛рдБ image рдХреЛ push рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

┬а

  ` `- htyagi2233/jenkins-nodejs

┬а

┬а

  **тЬЕ Jenkins Pipeline**

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `tools{

  `        `nodejs 'Nodejs'

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

  `        `stage('node stage'){

  `            `steps{

  `                `sh 'node -v'

  `                `sh 'npm -v'

  `                `sh 'npm install'

  `            `}

  `        `}

  `        `stage('docker build'){

  `            `steps{

  `                `sh 'docker -v'

  `            `}

  `        `}

        

  `    `}

┬а

  }

┬а

┬а

┬а

┬а

┬а

  **тЭМ Error Explanation**

┬а

  + docker -v\
  /var/jenkins\_home/workspace/node-js-project@tmp/durable-487b5ad6/script.sh.copy: 1: docker: not found

┬а

┬а

  classic **Docker-in-Docker** (DinD) issue рд╣реИред

  Jenkins container рдореЗрдВ Docker CLI рддреЛ install рд╣реЛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЙрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП actual Docker daemon рдЪрд╛рд╣рд┐рдП тАФ рдЬреЛ container рдореЗрдВ рдирд╣реАрдВ рдЪрд▓ рд╕рдХрддреАред

┬а

┬а

┬а

  **Project-6:**

┬а

  **Step-тЬЕ Solution**

- ` `We got this error because docker can nor install inside the docker container 
- So we will create a Dockerfile and build an image 

┬а

- Jenkins (jenkins/jenkins:jdk21) рдмреЗрд╕ рдЗрдореЗрдЬ рд╣реИ
- Docker CLI, plugins рдЖрджрд┐ install рд╣реЛ рд░рд╣реЗ рд╣реИрдВ
- Jenkins user рдХреЛ docker group рдореЗрдВ add рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ





\# vi Dockerfile



FROM jenkins/jenkins:jdk21



USER root



\# Install dependencies

RUN apt-get update && \

`    `apt-get install -y \

`        `ca-certificates \

`        `curl \

`        `gnupg \

`        `lsb-release



\# Add DockerтАЩs official GPG key

RUN install -m 0755 -d /etc/apt/keyrings && \

`    `curl -fsSL <https://download.docker.com/linux/debian/gpg> | gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \

`    `chmod a+r /etc/apt/keyrings/docker.gpg



\# Add Docker repo for Debian (not Ubuntu)

RUN echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.gpg] <https://download.docker.com/linux/debian> \

`    `bookworm stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null



\# Install Docker

RUN apt-get update && \

`    `apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin && \

`    `apt-get clean





\# Add Jenkins user to Docker group (safe)

RUN getent group docker || groupadd docker && usermod -aG docker jenkins



USER jenkins













**тЬЕ рдЕрдм рдХреНрдпрд╛ рд╣реЛ рдкрд╛рдПрдЧрд╛?**

- Jenkins pipeline рдореЗрдВ docker build, docker push, docker images, etc. commands рдЪрд▓ рдкрд╛рдПрдВрдЧреАред
- Docker daemon host machine рдкрд░ рд╣реА рд░рд╣реЗрдЧрд╛ тАФ container рд╕рд┐рд░реНрдл CLI рд╕реЗ access рдХрд░реЗрдЧрд╛ред





**ЁЯЫая╕П 1. тЬЕ Build the Docker Image for Docker Jenkins Container**\
тЖТ Source code рд╕реЗ Dockerfile рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Node.js рдРрдк рдХреА Docker image рддреИрдпрд╛рд░ рдХрд░рдирд╛ред



root@test:/htyagi2233# docker build -t jenkins/jenkins .





root@test:/htyagi2233# docker images

REPOSITORY        TAG       IMAGE ID       CREATED      SIZE

jenkins/jenkins   jdk21     ac09998055cc   6 days ago   480MB









**тЦ╢я╕П 2. Run the container with Docker socket mount:**

docker run -d --name jenkins -p 8080:8080 -v jenkins\_home:/var/jenkins\_home jenkins/jenkins







**тЦ╢я╕П 3. Login Jenkins & Create Jenkins Pipeline** 



pipeline{

`    `agent any

`    `options {

`        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

`    `}

`    `tools{

`        `nodejs 'Nodejs'

`    `}

`    `stages{

`        `stage('Git Checkout'){

`            `steps{

`                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

`            `}

`        `}

`        `stage('node stage'){

`            `steps{

`                `sh 'node -v'

`                `sh 'npm -v'

`                `sh 'npm install'

`            `}

`        `}

`        `stage('docker build'){

`            `steps{

`                `sh 'docker -v'

`            `}

`        `}



`    `}



}





**тЬЕ 4. Job Run рдХрд░реЗрдВ**

- Left menu тЖТ Build Now рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ



**тЬЕ 5. Console Output рдЪреЗрдХ рдХрд░реЗрдВ**

- Left рдореЗрдВ Build Number (#1) рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
- рдлрд┐рд░ тЖТ Console Output рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ



**тЬЕ Expected Output:**



ЁЯФН Checking Docker version inside Jenkins container...\
Docker version 24.0.5, build abcdef1234

тЬЕ рдЗрд╕рдХрд╛ рдорддрд▓рдм Jenkins container рдХреЗ рдЕрдВрджрд░ рд╕реЗ Docker CLI successfully рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред







**Project-7:**

**Step- Now build the image For NodeJS to deploy and push into DockerHub**



- **Add the stage to build the image and push into DockerHub in jenkins Pipeline** 

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `tools{

  `        `nodejs 'Nodejs'

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

  `        `stage('node stage'){

  `            `steps{

  `                `sh 'node -v'

  `                `sh 'npm -v'

  `                `sh 'npm install'

  `            `}

  `        `}

  `        `stage('docker build'){

  `            `steps{

  `                `sh 'docker -v'

  `                `sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

  `            `}

  `        `}

        

  `    `}

┬а

  }

┬а

┬а

┬а

┬а

- **Error-**

  + docker build -t htyagi2233/jenkins-nodejs:latest .\
  ERROR: Cannot connect to the Docker daemon at unix://**/var/run/docker.sock**. Is the docker daemon running?

┬а

┬а

  **Project-8:**

  **Step-  Building Docker Image For NodeJS- Permission Access** 

┬а

┬а

┬а

- **Stop and delete the old container**

  docker stop <jenkins container ID>

  docker rm <jenkins container ID>

┬а

┬а

┬а

  **ЁЯФз Target: Jenkins container рдХреЛ Docker daemon (/var/run/docker.sock) access рдХрд░рдиреЗ рдХреА permission рджреЗрдирд╛**

  Docker socket рдХреЛ access рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Jenkins container рдХреЛ рдЙрд╕реА **group ID** (GID) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ host system рдкрд░ Docker socket рдХреА рд╣реИред

┬а

┬а

┬а

  **тЬЕ Step-by-step: Docker Group Permission рджреЗрдирд╛**

┬а

  **ЁЯФ╣ Step 1: Host system рдкрд░ Docker socket рдХреА group ID рдкрддрд╛ рдХрд░реЗрдВ**

  Host (рдЬрд╣рд╛рдБ Docker install рд╣реИ) рдкрд░ command рдЪрд▓рд╛рдПрдБ:

┬а

  stat -c '%g' /var/run/docker.sock

  рдЙрджрд╛рд╣рд░рдг output:

┬а

  998

рдпрд╣рд╛рдБ 998 Docker socket рдХрд╛ group ID (GID) рд╣реИред









**ЁЯФ╣ Step 2: Jenkins container рдХреЛ Docker run рдХрд░рддреЗ рд╕рдордп рдпрд╣ GID рджреЗрдВ**

**тЬЕ рддрд░реАрдХрд╛ A: Auto-detect and pass using --group-add**

**Create a docker jenkins container** 



docker run -d \\
`  `--name jenkins \\
`  `-p 8080:8080 \\
`  `-v jenkins\_home:/var/jenkins\_home \\
`  `-v /var/run/docker.sock:/var/run/docker.sock \\
`  `-v ~/.kube/config:/var/jenkins\_home/.kube/config \\
`  `--group-add $(stat -c '%g' /var/run/docker.sock) \\
`  `jenkins/jenkins:lts







ЁЯФР --group-add flag Jenkins container рдХреЛ host Docker socket рд╡рд╛рд▓реА group рдореЗрдВ рдбрд╛рд▓ рджреЗрддрд╛ рд╣реИред











**Login into Jenkins** 

**<Server ip>:8080** 

**Again build the image and push into DockerHub**



pipeline{

`    `agent any

`    `options {

`        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

`    `}

`    `tools{

`        `nodejs 'Nodejs'

`    `}

`    `stages{

`        `stage('Git Checkout'){

`            `steps{

`                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

`            `}

`        `}

`        `stage('node stage'){

`            `steps{

`                `sh 'node -v'

`                `sh 'npm -v'

`                `sh 'npm install'

`            `}

`        `}

`        `stage('docker build'){

`            `steps{

`                `sh 'docker -v'

`                `sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

`            `}

`        `}



`    `}



}









**Project-9:**

**Step-  Pushing the Docker Image in Docker Hub**



┬а

  **ЁЯР│ STEP 1: DockerHub Token Generate рдХрд░рдирд╛**

DockerHub рдЕрдм Token-based authentication рдХреЛ recommend рдХрд░рддрд╛ рд╣реИ (password рдХреА рдЬрдЧрд╣) тАФ рдЬрд╝реНрдпрд╛рджрд╛ secure рд╣реЛрддрд╛ рд╣реИред

**ЁЯФз рдХреИрд╕реЗ рдХрд░реЗрдВ:**

- Login рдХрд░реЗрдВ:\
  ЁЯСЙ <https://hub.docker.com>
- Top-right тЖТ Click on your **profile icon** тЖТ Go to **Account Settings**
- Left side рдореЗрдВ тЖТ Click on **Security**
- Under **Access Tokens** тЖТ Click on **New Access Token**
- Fill Details:
  - **Token Description:** e.g. jenkins-pipeline-token
  - **Access Level:**\
    тЬЕ Select **Read/Write**
- Click on **Generate**
- **Important:**
  - **рдЬреЛ token рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛, рдЙрд╕реЗ рдХрд╣реАрдВ copy/save рдХрд░ рд▓реЗрдВ**
  - **рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рдмрд╛рд░ рджрд┐рдЦрддрд╛ рд╣реИ!**



**ЁЯФР STEP 2: Jenkins рдореЗрдВ DockerHub Token Add рдХрд░рдирд╛**

**Login into Jenkins**

рдЕрдм рд╣рдореЗрдВ рдпреЗ token Jenkins рдХреЛ securely рджреЗрдирд╛ рд╣реИред

**ЁЯУе Jenkins рдореЗрдВ Credential Add рдХрд░реЗрдВ:**

- Jenkins UI тЖТ Manage Jenkins тЖТ Credentials
- Select:\
  Global тЖТ (global) тЖТ Add Credentials
- Fill the form:
  - **Kind:** Username with password
  - **Username:** *Your DockerHub username*\
    (e.g. htyagi2233)
  - **Password:** *Paste the token you generated*
  - **ID:**\
\
    dockerhub-creds\
\
    *(рдпрд╛ рдХреЛрдИ рдФрд░ ID рдЬреЛ рдЖрдк pipeline рдореЗрдВ use рдХрд░рдирд╛ рдЪрд╛рд╣реЗрдВ)*
  - **Description:**\
    e.g. DockerHub token for Jenkins pipeline
- Click **Save**

┬а



\# dockerhub-creds







pipeline{

`    `agent any

`    `options {

`        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

`    `}

`    `tools{

`        `nodejs 'Nodejs'

`    `}

`    `environment{

`        `dockercred = credentials('dockerhub-creds')

`    `}

`    `stages{

`        `stage('Git Checkout'){

`            `steps{

`                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

`            `}

`        `}

`        `stage('node stage'){

`            `steps{

`                `sh 'node -v'

`                `sh 'npm -v'

`                `sh 'npm install'

`            `}

`        `}

`        `stage('docker build'){

`            `steps{

`                `sh 'docker -v'

`                `sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

`                `sh 'echo $dockercred\_PSW | docker login -u $dockercred\_USR --password-stdin'

`                `sh 'docker push htyagi2233/jenkins-nodejs:latest'

`            `}

`        `}



`    `}



}







**ЁЯОЙ рдЕрдм рдЖрдк рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?**

- Jenkins pipeline рд╕реЗ DockerHub login рд╣реЛрдЧрд╛
- Image build рд╣реЛрдЧреА
- Secure рддрд░реАрдХреЗ рд╕реЗ push рднреА рд╣реЛрдЧреА тАФ рдмрд┐рдирд╛ token рдХреЛ hardcode рдХрд┐рдП





**DockerHub Repository verify - image successfully push**

- DockerHub рдореЗрдВ login рдХрд░реЗрдВред
- рдКрдкрд░-right рдореЗрдВ рдЕрдкрдиреЗ **username** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ **Repositories** рдореЗрдВ рдЬрд╛рдПрдБред
- htyagi2233/jenkins-nodejs рд░рдкреЛ рдЦреЛрд▓реЗрдВред
- рд╡рд╣рд╛рдБ рдЖрдкрдХреЛ **Tags** section рдореЗрдВ рдЖрдкрдХреЗ pushed image рдХреЗ рдЯреИрдЧ (рдЬреИрд╕реЗ latest) рдФрд░ digest рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗред\
  рдорддрд▓рдм image successfully uploaded рд╣реЛ рдЪреБрдХрд╛ рд╣реИ 









**Project-10:**

**Step- AWS Integration with Jenkins on Docker**



- **Update the Dockerfile and add the steps to install aws cli** 
- **AWS CLI installation reference document**  

  <https://docs.aws.amazon.com/cli/latest/userguide/getting-started-version.html>

┬а

  # vi dockerfile

┬а

┬а

  FROM jenkins/jenkins:jdk21

┬а

  USER root

┬а

  # Install dependencies

  RUN apt-get update && \

  `    `apt-get install -y \

  `        `ca-certificates \

  `        `curl \

  `        `gnupg \

  `        `lsb-release

┬а

  # Add DockerтАЩs official GPG key

  RUN install -m 0755 -d /etc/apt/keyrings && \

  `    `curl -fsSL <https://download.docker.com/linux/debian/gpg> | gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \

  `    `chmod a+r /etc/apt/keyrings/docker.gpg

┬а

  # Add Docker repo for Debian (not Ubuntu)

  RUN echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.gpg] <https://download.docker.com/linux/debian> \

  `    `bookworm stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

┬а

  # Install Docker

  RUN apt-get update && \

  `    `apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin && \

  `    `apt-get clean

┬а

┬а

  # Add Jenkins user to Docker group (safe)

  RUN getent group docker || groupadd docker && usermod -aG docker jenkins

┬а

┬а

  # Install AWS CLI v2

  RUN curl "<https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.0.30.zip>" -o "awscliv2.zip" && \

  `    `apt-get install -y unzip && \

  `    `unzip awscliv2.zip && \

      ./aws/install && \

  `    `rm -rf awscliv2.zip aws

┬а

  USER jenkins

┬а

┬а

┬а

┬а

- **Build the Image** 

  docker build -t jenkins/jenkins .

┬а

┬а

- **Stop and delete the old container** 

  docker stop 88

  docker rm 88

┬а

┬а

- **Recreate the Container with the latest build Image** 

  docker run -d --name jenkins -p 8080:8080 -v jenkins\_home:/var/jenkins\_home -v /var/run/docker.sock:/var/run/docker.sock --group-add $(stat -c '%g' /var/run/docker.sock) jenkins/jenkins

┬а

┬а

┬а

┬а

┬а

- **# Jenkins Pipeline** 

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `tools{

  `        `nodejs 'Nodejs'

  `    `}

  `    `environment{

  `        `dockercred = credentials('dockerhub-creds')

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

  `        `stage('node stage'){

  `            `steps{

  `                `sh 'node -v'

  `                `sh 'npm -v'

  `                `sh 'npm install'

  `            `}

  `        `}

  `        `stage('docker build'){

  `            `steps{

  `                `sh 'docker -v'

  `                `sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

  `                `sh 'echo $dockercred\_PSW | docker login -u $dockercred\_USR --password-stdin'

  `                `sh 'docker push htyagi2233/jenkins-nodejs:latest'

  `            `}

  `        `}

  `        `stage('aws integration'){

  `            `steps{

  `                `sh 'aws --version'

  `            `}

  `        `}

        

  `    `}

┬а

  }

┬а

┬а

┬а

┬а

┬а

  **тЭМ Error Explanation**

  **We got the error here** 

┬а

┬а

┬а

┬а

┬а

  **тЬЕ Solution**

  **тЬЕ STEP 1: Install AWS Credentials Plugin in Jenkins**

  **ЁЯФз Install Plugin:**

- Jenkins UI тЖТ **Manage Jenkins**
- Go to тЖТ **Plugins**
- Click тЖТ **Available** tab
- Search: AWS Credentials
- тЬЕ Select and click **Install without restart**



**тЬЕ STEP 2: Add AWS Access Key Credentials in Jenkins**

**ЁЯФР Add AWS Credentials:**

- Jenkins тЖТ **Manage Jenkins** тЖТ **Credentials**
- Choose тЖТ (global) scope
- Click **Add Credentials**

┬а

**Fill Details:**

- **Kind:** AWS Credentials
- **Access Key ID:** Your AWS IAM access key
- **Secret Access Key:** Your AWS IAM secret
- **ID:**\
  Example: aws-eks-creds\
  *(YouтАЩll use this ID in your pipeline)*
- Click **Save**





**тЬЕ STEP 3: Jenkins Pipeline to Verify AWS CLI is Working**



pipeline{

`    `agent any

`    `options {

`        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

`    `}

`    `tools{

`        `nodejs 'Nodejs'

`    `}

`    `environment{

`        `dockercred = credentials('dockerhub-creds')

`        `awscred = credentials('aws-creds')

`    `}

`    `stages{

`        `stage('Git Checkout'){

`            `steps{

`                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

`            `}

`        `}

`        `// stage('node stage'){

`        `//     steps{

`        `//         sh 'node -v'

`        `//         sh 'npm -v'

`        `//         sh 'npm install'

`        `//     }

`        `// }

`        `// stage('docker build'){

`        `//     steps{

`        `//         sh 'docker -v'

`        `//         sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

`        `//         sh 'echo $dockercred\_PSW | docker login -u $dockercred\_USR --password-stdin'

`        `//         sh 'docker push htyagi2233/jenkins-nodejs:latest'

`        `//     }

`        `// }

`        `stage('aws integration'){

`            `steps{

`                `sh 'aws --version'

`                `sh 'aws ec2 describe-instances --region us-east-1'

`            `}

`        `}



`    `}



}





**тЬЕ Output**



- Now run the Pipeline and verify this time it's work 

┬а

┬а

  **Project-11:**

  **Step- Kubernetes Manifest Files for NodeJS for AWS EKS Deployment**  

┬а

- **Create a K8s deployment file** 

┬а

  apiVersion: apps/v1

  kind: Deployment

  metadata:

  `┬а `name: project-k8s

  spec:

  `┬а `replicas: 3

  `┬а `selector:

  `┬а ┬а `matchLabels:

  `┬а ┬а ┬а `app: project-k8s

  `┬а `template:

  `┬а ┬а `metadata:

  `┬а ┬а ┬а `labels:

  `┬а ┬а ┬а ┬а `app: project-k8s

  `┬а ┬а `spec:

  `┬а ┬а ┬а `containers:

  `┬а ┬а ┬а `- name: project-k8s

  `┬а ┬а ┬а ┬а `image: htyagi2233/jenkins-nodejs:latest

  `┬а ┬а ┬а ┬а `ports:

  `┬а ┬а ┬а ┬а `- containerPort: 3000

  ---

  apiVersion: v1

  kind: Service

  metadata:

  `┬а `name: project-k8s

  spec:

  `┬а `type: Loadbalancer

  `┬а `selector:

  `┬а ┬а `app: project-k8s

  `┬а `ports:

  `┬а `- protocol: TCP

  `┬а ┬а `port: 80

  `┬а ┬а `targetPort: 3000 #container port

  `┬а ┬а `nodePort: 30080

┬а

┬а

┬а

┬а

┬а

  **Step-  Kubernetes Setup & Installation**

┬а

┬а

  **Step 1: Prerequisites**

- **AWS Account**: Ensure you have an AWS account.
- **IAM Permissions**: Ensure you have the necessary IAM permissions to create EKS clusters, IAM roles, and other related resources.

**Step 2: Create IAM Roles for EKS**

**Create the EKS Service Role**

- **Navigate to IAM**: Open the IAM console at [**https://console.aws.amazon.com/iam/**](https://console.aws.amazon.com/iam/).
- **Create Role**: 
  - **In the left navigation pane, click on "Roles".**
  - **Click on the "Create role" button.**
  - **Select EKS - Cluster as the use case.**
  - **Click "Next".**
- **Attach Policy**: 
  - **Select the AmazonEKSClusterPolicy.**
  - **Click "Next".**
- **Review and Create**: 
  - **Role Name - RoleForEKSCluster**
  - **Click "Create role".**

┬а







**Create the EKS Nodegroup Role**

- **Create Another Role**: 
  - **In the left navigation pane, click on "Roles".**
  - **Click on the "Create role" button.**
  - **Select EC2 as the use case.**
  - **Click "Next".**
- **Attach Policies**: 
  - **Select the AmazonEKSWorkerNodePolicy, AmazonEC2ContainerRegistryReadOnly, and AmazonEKS\_CNI\_Policy.**
  - **Click "Next".**
- **Review and Create**: 
  - **The role name will be automatically generated. Review the settings.**            
  - **Click "Create role".**
  - **Role Name - RoleForEKSNodegroup**







**Step 3: Create an EKS Cluster**

- **Navigate to EKS**: Open the EKS console at [**https://console.aws.amazon.com/eks/**](https://console.aws.amazon.com/eks/).
- **Create Cluster**: 
  - **Click on the "Create cluster" button.**
  - **Select "Create cluster" under the "Amazon EKS" section.**
- **Choose Cluster Configuration**: 
  - **Select "Provision your own infrastructure" and click "Next".**
- **Configure Cluster**: 
  - **Enter a Cluster name (e.g., my-eks-cluster).**
  - **Choose a Kubernetes version (e.g., 1.30).**
  - **Choose Cluster endpoint access (public or private).**
  - **Choose Cluster logging (optional).**
- **Configure Node Groups**: 
  - **Click on "Add node group".**
  - **Enter a Node group name (e.g., my-nodegroup).**
  - **Choose an AMI type (e.g., Amazon Linux 2025).**
  - **Choose an Instance type (e.g., t4g.medium).**
  - **Specify the Number of nodes (e.g., 2).**
  - **Choose a Subnet (e.g., default VPC or create a new one).**
  - **Choose an IAM role (select the EKSNodegroupRole created earlier).**
- **Review and Create**: 
  - **Review all the settings.**
  - **Click on the "Create" button.**

**Step 4: Configure kubectl**

- **Update kubeconfig**:
  - **In the EKS console, select your cluster.**
  - **Click on the "Update kubeconfig" button.**
  - **This will download the kubeconfig file to your local machine.**
- **Verify kubectl Configuration**:
  - **Open a terminal and run:** 



Shell

- kubectl get svc\
  You should see the Kubernetes services running in your cluster.

**Step 5: Deploy an Application**

- **Create a Deployment**:



Shell

- kubectl create deployment nginx-deployment --image=nginx:1.30
- **Expose the Deployment as a Service**:

┬а

  Shell

- kubectl expose deployment nginx-deployment --type=LoadBalancer --port=80
- **Check the External IP**:

┬а

  Shell

- kubectl get svc\
  Wait for the EXTERNAL-IP to be assigned. You can then access the NGINX server by navigating to the external IP in your web browser.

┬а

**Step 6: Clean Up**

- **Delete the Node Group**:
  - **In the EKS console, select your cluster.**
  - **Click on the "Node groups" tab.**
  - **Select the node group and click on the "Delete" button.**
- **Delete the Cluster**:
  - **In the EKS console, select your cluster.**
  - **Click on the "Delete" button.**
  - **Confirm the deletion.**
- **Delete IAM Roles**:
  - **In the IAM console, delete the EKSServiceRole and EKSNodegroupRole.**







**Jenkins Pipeline -** 

Go to Jenkins and create a new Pipeline for testing Test-kubectl-version



pipeline{

`    `agent any

`    `stages{

`        `stage('k8s version'){

`            `steps{

`                `sh 'kubectl version --client'

`            `}

`        `}

`    `}

}







**Error-** 



\+ kubectl -v\
/var/jenkins\_home/workspace/NodeJs-k8s@tmp/durable-63259db9/script.sh.copy: 1: kubectl: not found









**Project-12:**

**Update our Dockerfile -** 

- **We will add the kubect**
- **Officially Website** 

  <https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/>

┬а

┬а

┬а

  FROM jenkins/jenkins:jdk21

  USER root

┬а

  # Install dependencies

  RUN apt-get update && \

  `    `apt-get install -y \

  `        `ca-certificates \

  `        `curl \

  `        `gnupg \

  `        `lsb-release

┬а

  # Add DockerтАЩs official GPG key

  RUN install -m 0755 -d /etc/apt/keyrings && \

  `    `curl -fsSL <https://download.docker.com/linux/debian/gpg> | gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \

  `    `chmod a+r /etc/apt/keyrings/docker.gpg

┬а

  # Add Docker repo for Debian (not Ubuntu)

  RUN echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.gpg] <https://download.docker.com/linux/debian> \

  `    `bookworm stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

┬а

  # Install Docker

  RUN apt-get update && \

  `    `apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin && \

  `    `apt-get clean

┬а

┬а

  # Add Jenkins user to Docker group (safe)

  RUN getent group docker || groupadd docker && usermod -aG docker jenkins

┬а

  **# Install AWS CLI v2**

  RUN curl "<https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.0.30.zip>" -o "awscliv2.zip" && \

  `    `apt-get install -y unzip && \

  `    `unzip awscliv2.zip && \

      ./aws/install && \

  `    `rm -rf awscliv2.zip aws

┬а

┬а

  # Install the kubectl

  RUN  curl -LO "[https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl](https://dl.k8s.io/release/$\(curl%20-L%20-s%20https:/dl.k8s.io/release/stable.txt\)/bin/linux/amd64/kubectl)" && \

  `     `install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl && \

  `     `chmod +x kubectl && \

  `     `mkdir -p ~/.local/bin && \

  `     `mv ./kubectl ~/.local/bin/kubectl

┬а

  USER jenkins

┬а

┬а

┬а

┬а

- **Build the Image** 

  docker build -t jenkins/jenkins .

┬а

┬а

- **Stop and delete the old container** 

  docker stop 88

  docker rm 88

┬а

┬а

- **Recreate the Container with the latest build Image** 

┬а

  docker run -d --name jenkins -p 8080:8080 -v jenkins\_home:/var/jenkins\_home -v /var/run/docker.sock:/var/run/docker.sock --group-add $(stat -c '%g' /var/run/docker.sock) jenkins/jenkins

  261681eb0b030c2f24e90f720e70702e1337ead640396da9509b78b907b27ba2

┬а

┬а

- **Login into Jenkins** 
- **Go to Jenkins and create a new Pipeline for testing Test-kubectl-version**

┬а

┬а

  pipeline{

  `    `agent any

  `    `stages{

  `        `stage('k8s version'){

  `            `steps{

  `                `sh 'kubectl version --client'

  `            `}

  `        `}

  `    `}

  }

┬а

┬а

┬а

- **Build the Job and see Job has run success**

┬а

  kubectl version --client

┬а

  + kubectl version --client

  Client Version: v1.34.0

  Kustomize Version: v5.7.1

┬а

┬а

┬а

┬а

  **Project-13:**

  **Step-  NodeJS Project End to End Deployment** 

┬а

  **Part- A ) For AWS EKS Cluster deployment** 

┬а

  **ЁЯз▒ Prerequisites:**

┬а

- тЬЕ Jenkins Docker container рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИред 
- тЬЕ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ Kubernetes cluster рд╣реИ -EKS 
- тЬЕ Jenkins container рдХреЗ рдкрд╛рд╕ kubeconfig access рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╡рд╣ Kubernetes API рд╕реЗ рдмрд╛рдд рдХрд░ рд╕рдХреЗред
- тЬЕ Jenkins рдореЗрдВ kubectl рдФрд░ kubectl credentials properly configured рд╣реЛрдВред

  рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдЕрдкрдиреА pipeline рдореЗрдВ рдпреЗ stage add рдХрд░реЗрдВрдЧреЗ 

  aws eks update-kubeconfig --region region-code --name my-cluster

- Github repo рдореЗрдВ updated Dockerfile рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП 

┬а

- тЬЕ Jenkins рдореЗрдВ рдПрдХ pipeline job рдмрдирд╛ рд╣реЛред

┬а





**тЬЕ Jenkins Docker container рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ on local system** 

**Dockerfile**





FROM jenkins/jenkins:jdk21



USER root



\# Install dependencies

RUN apt-get update && \

`    `apt-get install -y \

`        `ca-certificates \

`        `curl \

`        `gnupg \

`        `lsb-release



\# Add DockerтАЩs official GPG key

RUN install -m 0755 -d /etc/apt/keyrings && \

`    `curl -fsSL <https://download.docker.com/linux/debian/gpg> | gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \

`    `chmod a+r /etc/apt/keyrings/docker.gpg



\# Add Docker repo for Debian (not Ubuntu)

RUN echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.gpg] <https://download.docker.com/linux/debian> \

`    `bookworm stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null



\# Install Docker

RUN apt-get update && \

`    `apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin && \

`    `apt-get clean





\# Add Jenkins user to Docker group (safe)

RUN getent group docker || groupadd docker && usermod -aG docker jenkins



\# Install AWS CLI v2

RUN curl "<https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.0.30.zip>" -o "awscliv2.zip" && \

`    `apt-get install -y unzip && \

`    `unzip awscliv2.zip && \

./aws/install && \

`    `rm -rf awscliv2.zip aws





\# Install the kubectl

RUN  curl -LO "[https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl](https://dl.k8s.io/release/$\(curl%20-L%20-s%20https:/dl.k8s.io/release/stable.txt\)/bin/linux/amd64/kubectl)" && \

`     `install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl && \

`     `chmod +x kubectl && \

`     `mkdir -p ~/.local/bin && \

`     `mv ./kubectl ~/.local/bin/kubectl



USER jenkins











- **Build the image on local system and run the jenkins docker container**

┬а

  docker ps

  docker stop 26

  docker rm 26

┬а

┬а

  docker run -d --name jenkins -p 8080:8080 -v jenkins\_home:/var/jenkins\_home -v /var/run/docker.sock:/var/run/docker.sock --group-add $(stat -c '%g' /var/run/docker.sock) jenkins/jenkins

┬а

┬а

┬а

┬а

┬а

- **Dockerfile for Build the image in gitHub**
- **Note рдпреЗ Dockerfile рд╣рдорд╛рд░реЗ docker container рдХреЗ рд▓рд┐рдП рдЬреЛ dockerfile create рдХреА рдереА рдЙрд╕рд╕реЗ рдЕрд▓рдЧ рд░рд╣реЗрдЧреА рдЗрд╕рдХреЗ through рд╣рдо only aws eks cluster рдореЗрдВ  deployment рдХреЗ рд▓рд┐рдП рд▓рд┐рдП рдХрд░реЗрдиреЗрдЧреЗ рдЬрд┐рд╕ image рдореЗрдВ only рд╣рдорд╛рд░рд╛ NodeJS** 

┬а

  #BASE Image

  FROM node:latest

┬а

  #Working directory

  WORKDIR /usr/src/app

┬а

  #COPY package.json

  COPY package\*.json ./

┬а

  #TO get dependencies

  RUN npm install

┬а

  #COPY all app code

  COPY . .

┬а

  #Expose port

  EXPOSE 3000

┬а

  #Start server

  CMD ["npm", "start"]

┬а

┬а

┬а

┬а

- **Deployment file in GitHub Repo Application.yaml**

┬а

  apiVersion: apps/v1

  kind: Deployment

  metadata:

  `  `name: project-k8s

  spec:

  `  `replicas: 3

  `  `selector:

  `    `matchLabels:

  `      `app: project-k8s

  `  `template:

  `    `metadata:

  `      `labels:

  `        `app: project-k8s

  `    `spec:

  `      `containers:

  `      `- name: project-k8s

  `        `image: tampoohoonm/jenkins-nodejs:latest

  `        `ports:

  `        `- containerPort: 3000

┬а

  ---

┬а

  apiVersion: v1

  kind: Service

  metadata:

  `  `name: project-k8s

  spec:

  `  `type: LoadBalancer 

  `  `selector:

  `    `app: project-k8s

  `  `ports:

  `  `- protocol: TCP

  `    `port: 80

  `    `targetPort: 3000 #container port

  `    `nodePort: 30080

┬а

┬а

┬а

┬а

┬а

┬а

- **Push into Github**

  git add .

  git commit -m "Push Dockerfile and Deployment file"

  git push origin main

┬а

┬а

┬а

- **Jenkins Pipeline - we will update EKS kubeconfig**

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `tools{

  `        `nodejs 'Nodejs'

  `    `}

  `    `environment{

  `        `dockercred = credentials('dockerhub-creds')

  `        `awscred = credentials('aws-creds')

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

  `        `stage('node stage'){

  `            `steps{

  `                `sh 'node -v'

  `                `sh 'npm -v'

  `                `sh 'npm install'

  `            `}

  `        `}

  `        `stage('docker build'){

  `            `steps{

  `                `sh 'docker -v'

  `                `sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

  `                `sh 'echo $dockercred\_PSW | docker login -u $dockercred\_USR --password-stdin'

  `                `sh 'docker push htyagi2233/jenkins-nodejs:latest'

  `            `}

  `        `}

  `        `stage('aws integration'){

  `            `steps{

  `                `sh 'aws --version'

  `                `sh 'aws ec2 describe-instances --region us-east-1'

  `            `}

  `        `}

  `        `**stage('EKS kubeconfig update'){**

  `            `steps{

  `                `sh 'aws eks update-kubeconfig --region <region-code> --name <my-cluster>'

  `                `sh 'kubectl apply -f Application.yaml'

  `            `}

  `        `}

        

  `    `}

┬а

  }

┬а

┬а

┬а

┬а

┬а

┬а

- **Build the Job and check our AWS EKS Cluster** 

┬а

┬а

┬а

┬а

  **Project-14:**

  **Part- B ) For K8s server deployment** 

┬а

  **ЁЯз▒ Prerequisites:**

- тЬЕ Jenkins Docker container рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИред 
- тЬЕ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ Kubernetes cluster рд╣реИ (minikube, kind, EKS, GKE, etc.) - рд╣рдордиреЗ step - 12 рдореЗрдВ рдХрд░ рдЪреБрдХреЗ 

┬а

- тЬЕ Jenkins container рдХреЗ рдкрд╛рд╕ kubeconfig access рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╡рд╣ Kubernetes API рд╕реЗ рдмрд╛рдд рдХрд░ рд╕рдХреЗред
- тЬЕ Jenkins рдореЗрдВ kubectl рдФрд░ kubectl credentials properly configured рд╣реЛрдВред
- тЬЕ Jenkins рдореЗрдВ рдПрдХ pipeline job рдмрдирд╛ рд╣реЛред







**тЬЕ Jenkins Docker container рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИред** 



- Stop and delete the old container 

┬а

  docker stop 26

  docker rm 26

┬а

┬а

┬а

  **ЁЯУБ Step : kubeconfig Mount рдХрд░реЗрдВ Jenkins container рдореЗрдВ**

  рдЖрдкрдХреЛ рдЕрдкрдиреЗ Jenkins container рдХреЛ run рдХрд░рддреЗ рд╡рдХреНрдд ~/.kube/config рдпрд╛ cluster рдХреА credentials рдХреЛ mount рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ kubectl cluster рд╕реЗ рдмрд╛рдд рдХрд░ рд╕рдХреЗред

┬а

- **1. k8s server (192.168.192.133) рдкрд░ kubeconfig file рдХрд╣рд╛рдБ рд╣реИ, рдпрд╣ рдкрддрд╛ рдХрд░реЗрдВ**

  рдЖрдорддреМрд░ рдкрд░ рдпрд╣ рд╣реЛрддреА рд╣реИ:

- /home/<user>/.kube/config\
  рдпрд╛
- /etc/kubernetes/admin.conf

рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдЖрдкрдХреЗ k8s server рдкрд░ kubeconfig рд╣реИ /home/ubuntu/.kube/config



- 2. Jenkins server (рдЬрд╣рд╛ docker container jenkins рдЪрд▓ рд░рд╣рд╛ рд╣реИ ) (192.168.192.137) рдкрд░ kubeconfig copy рдХрд░реЗрдВ
- Or рд╣рдо menual copy рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИ 

┬а

  scp root@192.168.192.133:/root/.kube/config root@192.168.192.137:/root/.kube/config

┬а

┬а

┬а

┬а

- рд╣рдо рдПрдХ рдФрд░ volume рдХреЛ add рдХрд░реЗрдВрдЧреЗ \
  -v ~/.kube/config:/var/jenkins\_home/.kube/config 

┬а

┬а

┬а

┬а

- Recreate the Container with the latest build Image 

┬а

  docker run -d --name jenkins -p 8080:8080 -v jenkins\_home:/var/jenkins\_home -v /var/run/docker.sock:/var/run/docker.sock --group-add $(stat -c '%g' /var/run/docker.sock) -v ~/.kube/config:/var/jenkins\_home/.kube/config  jenkins/jenkins

┬а

┬а

┬а

┬а

- **Login into Jenkins** 

┬а

  **тЬЕ Jenkins рдореЗрдВ kubectl рдФрд░ kubectl credentials properly configured рд╣реЛрдВред**

  **Option B: Jenkins Credentials рдореЗрдВ Add рдХрд░рдирд╛ (Recommended for Security)**

- Jenkins тЖТ **Manage Jenkins** тЖТ **Credentials** тЖТ (Global or Folder Level)
- **Add Credentials** тЖТ **Kind: Secret file**
- Upload рдХрд░реЗрдВ рдЖрдкрдХрд╛ kubeconfig file
- рдЙрд╕реЗ рдПрдХ ID рджреЗрдВ, рдЬреИрд╕реЗ: kubeconfig





- **Go to Jenkins and create a new Pipeline for testing tset-k8s-cluster**  

┬а

┬а

  pipeline{

  `    `agent any

  `    `stages{

  `        `stage('k8s version'){

  `            `steps{

  `                `withCredentials([file(credentialsId: 'k8s-creds', variable: 'KUBECONFIG')]) {

  `                    `sh 'kubectl cluster-info'

  `                    `sh 'kubectl get nodes'

  `                `}

  `            `}

  `        `}

  `    `}

  }

┬а

┬а

┬а

- **Build the Job and see Job has run success**

┬а

┬а

┬а

┬а

┬а

  тЬЕ kubectl cluster-info

┬а

  + kubectl cluster-info

  Kubernetes control plane is running at <https://192.168.192.133:6443>

  CoreDNS is running at <https://192.168.192.133:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy>

  To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

┬а

┬а

  тЬЕ kubectl get nodes

┬а

  + kubectl get nodes

  NAME ┬а ┬а ┬а ┬а STATUS ┬а ROLES ┬а ┬а ┬а ┬а ┬а AGE ┬а ┬а VERSION

  k8s ┬а ┬а ┬а ┬а ┬аReady ┬а ┬аcontrol-plane ┬а 4d18h ┬а v1.33.4

  k8s-worker ┬а Ready ┬а ┬а<none> ┬а ┬а ┬а ┬а ┬а4d17h ┬а v1.33.4

┬а

┬а

┬а

┬а

┬а

┬а

┬а

- **Now final deployment on k8s** 

┬а

┬а

  pipeline{

  `    `agent any

  `    `options {

  `        `buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '2')

  `    `}

  `    `tools{

  `        `nodejs 'Nodejs'

  `    `}

  `    `environment{

  `        `dockercred = credentials('dockerhub-creds')

  `        `awscred = credentials('aws-creds')

  `    `}

  `    `stages{

  `        `stage('Git Checkout'){

  `            `steps{

  `                `checkout scmGit(branches: [[name: '\*/main']], extensions: [], userRemoteConfigs: [[url: '<https://github.com/htyagi2233/nodejs-docker-project.git>']])

  `            `}

  `        `}

  `        `stage('node stage'){

  `            `steps{

  `                `sh 'node -v'

  `                `sh 'npm -v'

  `                `sh 'npm install'

  `            `}

  `        `}

  `        `stage('docker build'){

  `            `steps{

  `                `sh 'docker -v'

  `                `sh 'docker build -t htyagi2233/jenkins-nodejs:latest .'

  `                `sh 'echo $dockercred\_PSW | docker login -u $dockercred\_USR --password-stdin'

  `                `sh 'docker push htyagi2233/jenkins-nodejs:latest'

  `            `}

  `        `}

  `        `stage('aws integration'){

  `            `steps{

  `                `sh 'aws --version'

  `                `sh 'aws ec2 describe-instances --region us-east-1'

  `            `}

  `        `}

  `        `stage('k8s version'){

  `            `steps{

  `                `withCredentials([file(credentialsId: 'k8s-creds', variable: 'KUBECONFIG')]) {

  `                    `sh 'kubectl cluster-info'

  `                    `sh 'kubectl get nodes'

  `                    `sh 'kubectl apply -f Application.yaml'

  `                `}

  `            `}

  `        `}

                

  `    `}

┬а

  }

┬а

┬а

┬а

- **Dockerfile for Build the image** 
- Note рдпреЗ Dockerfile рд╣рдорд╛рд░реЗ docker container рдХреЗ рд▓рд┐рдП рдЬреЛ dockerfile create рдХреА рдереА рдЙрд╕рд╕реЗ рдЕрд▓рдЧ рд░рд╣реЗрдЧреА рдЗрд╕рдХреЗ through рд╣рдо only aws eks cluster рдореЗрдВ  deployment рдХреЗ рд▓рд┐рдП рд▓рд┐рдП рдХрд░реЗрдиреЗрдЧреЗ рдЬрд┐рд╕ image рдореЗрдВ only рд╣рдорд╛рд░рд╛ NodeJS 

┬а

  #BASE Image

  FROM node:latest

┬а

  #Working directory

  WORKDIR /usr/src/app

┬а

  #COPY package.json

  COPY package\*.json ./

┬а

  #TO get dependencies

  RUN npm install

┬а

  #COPY all app code

  COPY . .

┬а

  #Expose port

  EXPOSE 3000

┬а

  #Start server

  CMD ["npm", "start"]

┬а

┬а

┬а

┬а

- **Create a K8s deployment file** 

┬а

  apiVersion: apps/v1

  kind: Deployment

  metadata:

  `┬а `name: project-k8s

  spec:

  `┬а `replicas: 3

  `┬а `selector:

  `┬а ┬а `matchLabels:

  `┬а ┬а ┬а `app: project-k8s

  `┬а `template:

  `┬а ┬а `metadata:

  `┬а ┬а ┬а `labels:

  `┬а ┬а ┬а ┬а `app: project-k8s

  `┬а ┬а `spec:

  `┬а ┬а ┬а `containers:

  `┬а ┬а ┬а `- name: project-k8s

  `┬а ┬а ┬а ┬а `image: htyagi2233/jenkins-nodejs:latest

  `┬а ┬а ┬а ┬а `ports:

  `┬а ┬а ┬а ┬а `- containerPort: 3000

  ---

  apiVersion: v1

  kind: Service

  metadata:

  `┬а `name: project-k8s

  spec:

  `┬а `type: NodePort

  `┬а `selector:

  `┬а ┬а `app: project-k8s

  `┬а `ports:

  `┬а `- protocol: TCP

  `┬а ┬а `port: 80

  `┬а ┬а `targetPort: 3000 #container port

  `┬а ┬а `nodePort: 30080

┬а

┬а

┬а

- **Build the Job and verify** 
  - Latest Docker image has pushed into DockerHub Repo
  - On K8s Server Deployment has created with NodePort Service 
  - So copy the Node Ip and Node Port 

┬а

- Open the Browser and test the application 

┬а

<http://192.168.192.133:30080/>











- **Bonus-** 

  docker exec -it <container\_name\_or\_id> bash

  docker exec -it jenkins-cicd cat /var/jenkins\_home/secrets/initialAdminPassword

┬а

  **docker container rm -f $(docker container ls -aq)**

